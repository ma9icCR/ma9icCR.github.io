<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Black Hat Python 2nd 11 | Ma9icCR</title><meta name="description" content="攻击取证取证人员通常是在发现缺陷事件后，或者是为了确定是否发生了“事件”而被叫来的人。他们通常需要受影响机器的 RAM (笔者注： Random Access Memory，随机存取存储器)的快照，以便捕获仅临时存储在内存中的加密密钥或其他信息。幸运的是，一个有才华的开发团队已经创建了一个完整的 Python 框架 Volatility ，它适合这个任务，被称为高级内存取证框架。事件响应者、取证人"><meta name="keywords" content="Black_Hat_Python_2nd"><meta name="author" content="Ma9icCR"><meta name="copyright" content="Ma9icCR"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://ma9iccr.github.io/2021-07/Black-Hat-Python-2nd-11/"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin="crossorigin"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta property="og:type" content="article"><meta property="og:title" content="Black Hat Python 2nd 11"><meta property="og:url" content="https://ma9iccr.github.io/2021-07/Black-Hat-Python-2nd-11/"><meta property="og:site_name" content="Ma9icCR"><meta property="og:description" content="攻击取证取证人员通常是在发现缺陷事件后，或者是为了确定是否发生了“事件”而被叫来的人。他们通常需要受影响机器的 RAM (笔者注： Random Access Memory，随机存取存储器)的快照，以便捕获仅临时存储在内存中的加密密钥或其他信息。幸运的是，一个有才华的开发团队已经创建了一个完整的 Python 框架 Volatility ，它适合这个任务，被称为高级内存取证框架。事件响应者、取证人"><meta property="og:image" content="https://ma9ic-image.obs.cn-north-4.myhuaweicloud.com/images/BHP2nd.jpg"><meta property="article:published_time" content="2021-07-23T04:30:56.000Z"><meta property="article:modified_time" content="2022-03-28T07:20:48.848Z"><meta name="twitter:card" content="summary"><script>var activateDarkMode = function () {
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#000')
  }
}
var activateLightMode = function () {
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#fff')
  }
}

var getCookies = function (name) {
  const value = `; ${document.cookie}`
  const parts = value.split(`; ${name}=`)
  if (parts.length === 2) return parts.pop().split(';').shift()
}

var autoChangeMode = 'false'
var t = getCookies('theme')
if (autoChangeMode === '1') {
  var isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
  var isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
  var isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined) {
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport) {
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour <= 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
    }
    window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
      if (Cookies.get('theme') === undefined) {
        e.matches ? activateDarkMode() : activateLightMode()
      }
    })
  } else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else if (autoChangeMode === '2') {
  now = new Date()
  hour = now.getHours()
  isNight = hour <= 6 || hour >= 18
  if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else {
  if (t === 'dark') activateDarkMode()
  else if (t === 'light') activateLightMode()
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="prev" title="PWN入门到入狱" href="https://ma9iccr.github.io/2022-03/PWN%E5%85%A5%E9%97%A8%E5%88%B0%E5%85%A5%E7%8B%B1/"><link rel="next" title="Black Hat Python 2nd 10" href="https://ma9iccr.github.io/2021-07/Black-Hat-Python-2nd-10/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  justifiedGallery: {
    js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
    css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
  },
  baiduPush: false,
  highlightCopy: true,
  highlightLang: true,
  isPhotoFigcaption: false,
  islazyload: true,
  isanchor: false    
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isSidebar: true,
  postUpdate: '2022-03-28 15:20:48'
}</script><noscript><style>
#nav {
  opacity: 1
}
.justified-gallery img{
  opacity: 1
}
</style></noscript><meta name="generator" content="Hexo 4.2.1"></head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="https://ma9ic-image.obs.cn-north-4.myhuaweicloud.com/images/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">34</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">11</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">8</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down menus-expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li><li><a class="site-page" href="/images/"><i class="fa-fw fas fa-image"></i><span> Image</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/navigate/"><i class="fa-fw fas fa-navigate"></i><span> Navigate</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><i class="fas fa-arrow-right on" id="toggle-sidebar"></i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#攻击取证"><span class="toc-number">1.</span> <span class="toc-text">攻击取证</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#安装"><span class="toc-number">1.1.</span> <span class="toc-text">安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#通用侦察"><span class="toc-number">1.2.</span> <span class="toc-text">通用侦察</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#用户侦察"><span class="toc-number">1.3.</span> <span class="toc-text">用户侦察</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#漏洞侦察"><span class="toc-number">1.4.</span> <span class="toc-text">漏洞侦察</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#volshell-接口"><span class="toc-number">1.5.</span> <span class="toc-text">volshell 接口</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#自定义-Volatility-插件"><span class="toc-number">1.6.</span> <span class="toc-text">自定义 Volatility 插件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Kicking-the-Tires"><span class="toc-number">1.6.1.</span> <span class="toc-text">Kicking the Tires</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Onward-前进吧"><span class="toc-number">1.7.</span> <span class="toc-text">Onward! (前进吧)</span></a></li></ol></li></ol></div></div></div><div id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://ma9ic-image.obs.cn-north-4.myhuaweicloud.com/images/BHP2nd.jpg)"><nav id="nav"><span class="pull-left" id="blog_name"><a class="blog_title" id="site-name" href="/">Ma9icCR</a></span><span class="pull-right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down menus-expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li><li><a class="site-page" href="/images/"><i class="fa-fw fas fa-image"></i><span> Image</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/navigate/"><i class="fa-fw fas fa-navigate"></i><span> Navigate</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><span class="toggle-menu close"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></span></span></nav><div id="post-info"><div id="post-title"><div class="posttitle">Black Hat Python 2nd 11</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><span class="post-meta__date-created" title="发表于 2021-07-23 12:30:56"><i class="far fa-calendar-alt fa-fw"></i> 发表于 2021-07-23</span><span class="post-meta__separator">|</span><span class="post-meta__date-updated" title="更新于 2022-03-28 15:20:48"><i class="fas fa-history fa-fw"></i> 更新于 2022-03-28</span></time><span class="post-meta__categories"><span class="post-meta__separator">|</span><i class="fas fa-inbox fa-fw post-meta__icon"></i><a class="post-meta__categories" href="/categories/books/">books</a></span></div><div class="meta-secondline"> </div><div class="meta-thirdline"><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta__icon"></i><span>阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><h1 id="攻击取证"><a href="#攻击取证" class="headerlink" title="攻击取证"></a>攻击取证</h1><p>取证人员通常是在发现缺陷事件后，或者是为了确定是否发生了“事件”而被叫来的人。他们通常需要受影响机器的 RAM (笔者注： Random Access Memory，随机存取存储器)的快照，以便捕获仅临时存储在内存中的加密密钥或其他信息。幸运的是，一个有才华的开发团队已经创建了一个完整的 Python 框架 <em>Volatility</em> ，它适合这个任务，被称为高级内存取证框架。事件响应者、取证人员和恶意软件分析师也可以将 <em>Volatility</em> 用于其他各种任务，包括检查内核对象、检查和转储进程信息等。</p>
<p>(笔者注： Volatility 是一款开源内存取证框架，能够对导出的内存镜像进行分析，通过获取内核数据结构，使用插件获取内存的详细情况以及系统的运行状态。特点：开源： Python 编写，易于和基于 python 的主机防御框架集成；支持多平台：Windows，Mac，Linux 全支持；易于扩展：通过插件来扩展 Volatility 的分析能力)</p>
<p>尽管 Volatility 是防御方的软件，但任何足够强大的工具都可以用于进攻或防守。我们将使用 Volatility 对目标用户执行侦察，并编写自己的攻击性插件来搜索在虚拟机（VM）上运行的防御能力较弱的进程。</p>
<p>假设你潜入一台机器，发现用户使用虚拟机进行敏感工作。很有可能用户还制作了虚拟机的快照作为安全措施以防出现任何错误问题，这更是好机会。我们将使用 Volatility 内存分析框架来分析快照，以了解 VM 是如何工作的以及哪些进程正在运行。我们还将调查可能存在的漏洞，以便进一步利用这些漏洞进行攻击。</p>
<p>我们开始吧！</p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>Volatility 已经存在了好几年，刚刚经历了一次彻底的改写。现在不仅代码库建立在 Python 3 上，而且整个框架都经过了重构，因此组件也是独立的；运行插件所需的所有情况都是自包含的。</p>
<p>让我们创建一个虚拟环境来处理 Volatility 。对于本例，我们在 Windows 机器上的 PowerShell 终端使用 Python 3。如果您也在 Windows 机器上工作，请确保安装了 <em>git</em> 。你可以在 <a href="https://git-scm.com/downloads/" target="_blank" rel="noopener">https://git-scm.com/downloads/</a> 下载。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">1</span>] PS&gt; python3 <span class="literal">-m</span> venv vol3</span><br><span class="line">PS&gt; vol3/Scripts/Activate.ps1</span><br><span class="line">PS&gt; cd vol3/</span><br><span class="line">[<span class="number">2</span>] PS&gt; git clone https://github.com/volatilityfoundation/volatility3.git</span><br><span class="line">PS&gt; cd volatility3/</span><br><span class="line">PS&gt; python setup.py  install</span><br><span class="line">[<span class="number">3</span>] PS&gt; pip install pycryptodome</span><br></pre></td></tr></table></figure>

<p>首先，我们创建一个名为 <em>vol3</em> 的新虚拟环境并将其激活[1]。接下来，我们进入虚拟环境目录并克隆 Volatility 3 的GitHub 存储库[2]，将其安装到虚拟环境中，最后安装 <em>pycryptodome</em> [3]，稍后我们将需要它。</p>
<p>要查看 Volatility 提供的插件和选项列表，请在 Windows 上使用以下命令：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PS&gt; vol -<span class="literal">-help</span></span><br></pre></td></tr></table></figure>

<p>在 Linux 或 Mac 上，使用虚拟环境中的 Python 可执行文件，如下所示：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$</span>&gt; python vol.py -<span class="literal">-help</span></span><br></pre></td></tr></table></figure>

<p>在本章中，我们将从命令行使用 Volatility ，但是您可能会遇到各种各样的框架。例如，请参阅 Volatility 的 Volumetric 项目，一个免费的基于 web 的 Volatility GUI（ <a href="https://github.com/volatilityfoundation/volumetric/" target="_blank" rel="noopener">https://github.com/volatilityfoundation/volumetric/</a> ）。您可以深入到 Volumetric 项目中的代码示例，看看如何在自己的程序中使用 Volatility 。此外，您还可以使用 <em>volshell</em> 接口，它为您提供了对 Volatility 框架的访问，并作为一个普通的交互式 Python shell 工作。</p>
<p>在下面的示例中，我们将使用 Volatility 命令行。为了节省空间，将输出编辑为仅显示已讨论的输出，因此请注意，您的输出将有更多的行和列。</p>
<p>现在让我们深入研究一些代码，看看框架内部：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">PS&gt; cd volatility/framework/plugins/windows/</span><br><span class="line">PS&gt; ls</span><br><span class="line">_init__.py    driverscan.py memmap.py       psscan.py  vadinfo.py</span><br><span class="line">bigpools.py   filescan.py   modscan.py      pstree.py  vadyarascan.py</span><br><span class="line">cachedump.py  handles.py    modules.py      registry/  verinfo.py</span><br><span class="line">callbacks.py  hashdump.py   mutantscan.py   ssdt.py    virtmap.py</span><br><span class="line">cmdline.py    info.py       netscan.py      strings.py</span><br><span class="line">dlllist.py    lsadump.py    poolscanner.py  svcscan.py</span><br><span class="line">driverirp.py  malfind.py    pslist.py       symlinkscan.py</span><br></pre></td></tr></table></figure>

<p>这个清单显示了 Windows <em>plugin</em> 目录中的 Python 文件。我们强烈建议您花一些时间查看这些文件中的代码。您将看到形成 Volatility 插件结构的循环模式。这将有助于你理解这个框架，但更重要的是，它会让你了解一个防御者的心态和意图。通过了解防御者的能力以及他们是如何完成目标的，你将使自己成为一个更有能力的黑客，并更好地了解如何保护自己不被发现。</p>
<p>现在我们已经准备好了分析框架，我们需要一些内存图像来分析。最简单的方法是拍摄自己的 Windows 10 虚拟机的快照。</p>
<p>首先，打开 Windows 虚拟机并启动一些进程（例如，记事本、计算器和浏览器）；我们将检查内存并跟踪这些进程是如何启动的。然后，使用您选择的虚拟机监控程序拍摄快照。在管理程序存储虚拟机的目录中，您将看到名称以 .vmem 或 .mem 结尾的新快照文件。让我们开始侦察吧！</p>
<p>请注意，您还可以在网上找到许多内存图像。本章中我们看到的一个图像是 PassMark Software 提供的（[<a href="https://www" target="_blank" rel="noopener">https://www</a> .osforensics.com/tools/volatility-workbench.html/](<a href="https://www" target="_blank" rel="noopener">https://www</a> .osforensics.com/tools/volatility-workbench.html/)）。Volatility Foundation 网站也有一些图像可以使用（<a href="https://github.com/volatilityfoundation/volatility/wiki/Memory-Samples/" target="_blank" rel="noopener">https://github.com/volatilityfoundation/volatility/wiki/Memory-Samples/</a>）</p>
<h2 id="通用侦察"><a href="#通用侦察" class="headerlink" title="通用侦察"></a>通用侦察</h2><p>让我们大致了解一下我们正在分析的机器。 <em>windows.info</em> 插件可以显示内存示例的操作系统和内核信息：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">1</span>] PS&gt;vol <span class="operator">-f</span> WinDev2007Eval<span class="literal">-Snapshot4</span>.vmem windows.info</span><br><span class="line">Volatility <span class="number">3</span> Framework <span class="number">1.2</span>.<span class="number">0</span><span class="literal">-beta</span>.<span class="number">1</span></span><br><span class="line">Progress:   <span class="number">33.01</span>               Scanning primary2 <span class="keyword">using</span> PdbSignatureScanner</span><br><span class="line">Variable        Value</span><br><span class="line">Kernel Base     <span class="number">0</span>xf80067a18000</span><br><span class="line">DTB             <span class="number">0</span>x1aa000</span><br><span class="line">primary <span class="number">0</span>       WindowsIntel32e</span><br><span class="line">memory_layer    <span class="number">1</span> FileLayer</span><br><span class="line">KdVersionBlock  <span class="number">0</span>xf800686272f0</span><br><span class="line">Major/Minor     <span class="number">15.19041</span></span><br><span class="line">MachineType     <span class="number">34404</span></span><br><span class="line">KeNumberProcessors      <span class="number">1</span></span><br><span class="line">SystemTime      <span class="number">2020</span><span class="literal">-09</span><span class="literal">-04</span> <span class="number">00</span>:<span class="number">53</span>:<span class="number">46</span></span><br><span class="line">NtProductType   NtProductWinNt</span><br><span class="line">NtMajorVersion  <span class="number">10</span></span><br><span class="line">NtMinorVersion  <span class="number">0</span></span><br><span class="line">PE MajorOperatingSystemVersion  <span class="number">10</span></span><br><span class="line">PE MinorOperatingSystemVersion  <span class="number">0</span></span><br><span class="line">PE Machine      <span class="number">34404</span></span><br></pre></td></tr></table></figure>

<p>我们使用 -f 选项和要使用的 Windows 插件， <em>windows.info</em> ，指定快照文件名[1]。 Volatility 读取并分析内存文件，并输出有关此 Windows 计算机的通识信息。我们可以看到，我们正在处理一个 Windows 10.0 虚拟机 ，它有一个单处理器和一个内存层。</p>
<p>在查看插件代码时，您可能会发现在内存映像文件上尝试几个插件很有实践教育意义。花时间阅读代码并查看相应的输出将向您展示代码应该如何工作以及防御者大体上的心态。</p>
<p>接下来是 <em>registry.printkey</em> 插件，可以打印注册表中某个键的值。注册表有大量有价值的信息， Volatility 提供了一种找到我们想要的所有值的方法。在这里，我们寻找已安装的服务。键 <em>/ControlSet001/Services</em> 显示 Service Control Manager (服务控制管理器)数据库，其中列出了所有已安装的服务：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">PS&gt;vol <span class="operator">-f</span> WinDev2007Eval<span class="literal">-7d959ee5</span>.vmem windows.registry.printkey -<span class="literal">-key</span> <span class="string">'ControlSet001\Services'</span></span><br><span class="line">Volatility <span class="number">3</span> Framework <span class="number">1.2</span>.<span class="number">0</span><span class="literal">-beta</span>.<span class="number">1</span></span><br><span class="line">Progress:   <span class="number">33.01</span>               Scanning primary2 <span class="keyword">using</span> PdbSignatureScanner</span><br><span class="line">... Key                                         Name    <span class="keyword">Data</span>       Volatile</span><br><span class="line">\REGISTRY\MACHINE\SYSTEM\ControlSet001\Services .NET CLR <span class="keyword">Data</span>      False</span><br><span class="line">\REGISTRY\MACHINE\SYSTEM\ControlSet001\Services Appinfo            False</span><br><span class="line">\REGISTRY\MACHINE\SYSTEM\ControlSet001\Services applockerfltr      False</span><br><span class="line">\REGISTRY\MACHINE\SYSTEM\ControlSet001\Services AtomicAlarmClock   False</span><br><span class="line">\REGISTRY\MACHINE\SYSTEM\ControlSet001\Services Beep               False</span><br><span class="line">\REGISTRY\MACHINE\SYSTEM\ControlSet001\Services fastfat            False</span><br><span class="line">\REGISTRY\MACHINE\SYSTEM\ControlSet001\Services MozillaMaintenance False</span><br><span class="line">\REGISTRY\MACHINE\SYSTEM\ControlSet001\Services NTDS               False</span><br><span class="line">\REGISTRY\MACHINE\SYSTEM\ControlSet001\Services Ntfs               False</span><br><span class="line">\REGISTRY\MACHINE\SYSTEM\ControlSet001\Services ShellHWDetection   False</span><br><span class="line">\REGISTRY\MACHINE\SYSTEM\ControlSet001\Services SQLWriter          False</span><br><span class="line">\REGISTRY\MACHINE\SYSTEM\ControlSet001\Services Tcpip              False</span><br><span class="line">\REGISTRY\MACHINE\SYSTEM\ControlSet001\Services Tcpip6             False</span><br><span class="line">\REGISTRY\MACHINE\SYSTEM\ControlSet001\Services terminpt           False</span><br><span class="line">\REGISTRY\MACHINE\SYSTEM\ControlSet001\Services W32Time            False</span><br><span class="line">\REGISTRY\MACHINE\SYSTEM\ControlSet001\Services WaaSMedicSvc       False</span><br><span class="line">\REGISTRY\MACHINE\SYSTEM\ControlSet001\Services WacomPen           False</span><br><span class="line">\REGISTRY\MACHINE\SYSTEM\ControlSet001\Services Winsock            False</span><br><span class="line">\REGISTRY\MACHINE\SYSTEM\ControlSet001\Services WinSock2           False</span><br><span class="line">\REGISTRY\MACHINE\SYSTEM\ControlSet001\Services WINUSB             False</span><br></pre></td></tr></table></figure>

<p>此输出显示计算机上已安装服务的列表（因空间原因而缩略了）。</p>
<h2 id="用户侦察"><a href="#用户侦察" class="headerlink" title="用户侦察"></a>用户侦察</h2><p>现在让我们对虚拟机的用户进行一些侦察。 <em>cmdline</em> 插件列出了创建快照时每个进程正在运行的命令行参数。这些进程给我们一个关于用户行为和意图的提示。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">PS&gt;vol <span class="operator">-f</span> WinDev2007Eval<span class="literal">-7d959ee5</span>.vmem windows.cmdline</span><br><span class="line">Volatility <span class="number">3</span> Framework <span class="number">1.2</span>.<span class="number">0</span><span class="literal">-beta</span>.<span class="number">1</span></span><br><span class="line">Progress:   <span class="number">33.01</span>               Scanning primary2 <span class="keyword">using</span> PdbSignatureScanner</span><br><span class="line">PID     <span class="keyword">Process</span> Args</span><br><span class="line"><span class="number">72</span>      Registry        Required memory at <span class="number">0</span>x20 is not valid (<span class="keyword">process</span> exited?)</span><br><span class="line"><span class="number">340</span>     smss.exe        Required memory at <span class="number">0</span>xa5f1873020 is inaccessible (swapped)</span><br><span class="line"><span class="number">564</span>     lsass.exe       C:\Windows\system32\lsass.exe</span><br><span class="line"><span class="number">624</span>     winlogon.exe    winlogon.exe</span><br><span class="line"><span class="number">2160</span>    MsMpEng.exe     <span class="string">"C:\ProgramData\Microsoft\Windows Defender\platform\4.18.2008.9-0\</span></span><br><span class="line"><span class="string">MsMpEng.exe"</span></span><br><span class="line"><span class="number">4732</span>    explorer.exe    C:\Windows\Explorer.EXE</span><br><span class="line"><span class="number">4848</span>    svchost.exe     C:\Windows\system32\svchost.exe <span class="literal">-k</span> ClipboardSvcGroup <span class="literal">-p</span></span><br><span class="line"><span class="number">4920</span>    dllhost.exe     C:\Windows\system32\DllHost.exe /Processid:&#123;AB8902B4<span class="literal">-09CA</span><span class="literal">-4BB6</span><span class="literal">-B78D</span>-</span><br><span class="line">A8F59079A8D5&#125;</span><br><span class="line"><span class="number">5084</span>    StartMenuExper  <span class="string">"C:\Windows\SystemApps\Microsoft.Windows. . ."</span></span><br><span class="line"><span class="number">5388</span>    MicrosoftEdge.  <span class="string">"C:\Windows\SystemApps\Microsoft.MicrosoftEdge_. . ."</span></span><br><span class="line"><span class="number">6452</span>    OneDrive.exe    <span class="string">"C:\Users\Administrator\AppData\Local\Microsoft\OneDrive\OneDrive.exe"</span> </span><br><span class="line">/background</span><br><span class="line"><span class="number">6484</span>    FreeDesktopClo  <span class="string">"C:\Program Files\Free Desktop Clock\FreeDesktopClock.exe"</span></span><br><span class="line"><span class="number">7092</span>    cmd.exe         <span class="string">"C:\Windows\system32\cmd.exe"</span> [<span class="number">1</span>]</span><br><span class="line"><span class="number">3312</span>    notepad.exe     notepad [<span class="number">2</span>]</span><br><span class="line"><span class="number">3824</span>    powershell.exe  <span class="string">"C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe"</span></span><br><span class="line"><span class="number">6448</span>    Calculator.exe  <span class="string">"C:\Program Files\WindowsApps\Microsoft.WindowsCalculator_. . ."</span></span><br><span class="line"><span class="number">6684</span>    firefox.exe     <span class="string">"C:\Program Files (x86)\Mozilla Firefox\firefox.exe"</span></span><br><span class="line"><span class="number">6432</span>    PowerToys.exe   <span class="string">"C:\Program Files\PowerToys\PowerToys.exe"</span></span><br><span class="line"><span class="number">7124</span>    nc64.exe        Required memory at <span class="number">0</span>x2d7020 is inaccessible (swapped)</span><br><span class="line"><span class="number">3324</span>    smartscreen.ex  C:\Windows\System32\smartscreen.exe <span class="literal">-Embedding</span></span><br><span class="line"><span class="number">4768</span>    ipconfig.exe    Required memory at <span class="number">0</span>x840308e020 is not valid (<span class="keyword">process</span> exited?)</span><br></pre></td></tr></table></figure>

<p>该列表显示进程 ID 、进程名和命令行以及启动进程的参数。您可以看到，大多数进程都是由系统本身启动的，很可能是在引导时启动的。 <em>cmd.exe</em> [1]和 <em>notepad.exe</em> [2]进程是用户启动进程的典型。</p>
<p>让我们用 <em>pslist</em> 插件更深入地研究正在运行的进程，它列出了拍摄快照时正在运行的进程。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">PS&gt;vol <span class="operator">-f</span> WinDev2007Eval<span class="literal">-7d959ee5</span>.vmem windows.pslist</span><br><span class="line">Volatility <span class="number">3</span> Framework <span class="number">1.2</span>.<span class="number">0</span><span class="literal">-beta</span>.<span class="number">1</span></span><br><span class="line">Progress:   <span class="number">33.01</span>               Scanning primary2 <span class="keyword">using</span> PdbSignatureScanner</span><br><span class="line">PID     PPID    ImageFileName   Offset(V)   Threads Handles SessionId   Wow64</span><br><span class="line"><span class="number">4</span>       <span class="number">0</span>       System          <span class="number">0</span>xa50bb3e6d040  <span class="number">129</span>     -       N/A     False</span><br><span class="line"><span class="number">72</span>      <span class="number">4</span>       Registry        <span class="number">0</span>xa50bb3fbd080  <span class="number">4</span>       -       N/A     False</span><br><span class="line"><span class="number">6452</span>    <span class="number">4732</span>    OneDrive.exe    <span class="number">0</span>xa50bb4d62080  <span class="number">25</span>      -       <span class="number">1</span>       True</span><br><span class="line"><span class="number">6484</span>    <span class="number">4732</span>    FreeDesktopClo  <span class="number">0</span>xa50bbb847300  <span class="number">1</span>       -       <span class="number">1</span>       False</span><br><span class="line"><span class="number">6212</span>    <span class="number">556</span>     SgrmBroker.exe  <span class="number">0</span>xa50bbb832080  <span class="number">6</span>       -       <span class="number">0</span>       False</span><br><span class="line"><span class="number">1636</span>    <span class="number">556</span>     svchost.exe     <span class="number">0</span>xa50bbadbe340  <span class="number">8</span>       -       <span class="number">0</span>       False</span><br><span class="line"><span class="number">7092</span>    <span class="number">4732</span>    cmd.exe         <span class="number">0</span>xa50bbbc4d080  <span class="number">1</span>       -       <span class="number">1</span>       False</span><br><span class="line"><span class="number">3312</span>    <span class="number">7092</span>    notepad.exe     <span class="number">0</span>xa50bbb69a080  <span class="number">3</span>       -       <span class="number">1</span>       False</span><br><span class="line"><span class="number">3824</span>    <span class="number">4732</span>    powershell.exe  <span class="number">0</span>xa50bbb92d080  <span class="number">11</span>      -       <span class="number">1</span>       False</span><br><span class="line"><span class="number">6448</span>    <span class="number">704</span>     Calculator.exe  <span class="number">0</span>xa50bb4d0d0c0  <span class="number">21</span>      -       <span class="number">1</span>       False</span><br><span class="line"><span class="number">4036</span>    <span class="number">6684</span>    firefox.exe     <span class="number">0</span>xa50bbb178080  <span class="number">0</span>       -       <span class="number">1</span>       True</span><br><span class="line"><span class="number">6432</span>    <span class="number">4732</span>    PowerToys.exe   <span class="number">0</span>xa50bb4d5a2c0  <span class="number">14</span>      -       <span class="number">1</span>       False</span><br><span class="line"><span class="number">4052</span>    <span class="number">4700</span>    PowerLauncher.  <span class="number">0</span>xa50bb7fd3080  <span class="number">16</span>      -       <span class="number">1</span>       False</span><br><span class="line"><span class="number">5340</span>    <span class="number">6432</span>    Microsoft.Powe  <span class="number">0</span>xa50bb736f080  <span class="number">15</span>      -       <span class="number">1</span>       False</span><br><span class="line"><span class="number">8564</span>    <span class="number">4732</span>    python<span class="literal">-3</span>.<span class="number">8.6</span><span class="literal">-a</span>  <span class="number">0</span>xa50bb7bc2080  <span class="number">1</span>       -       <span class="number">1</span>       True</span><br><span class="line"><span class="number">7124</span>    <span class="number">7092</span>    nc64.exe        <span class="number">0</span>xa50bbab89080  <span class="number">1</span>       -       <span class="number">1</span>       False</span><br><span class="line"><span class="number">3324</span>    <span class="number">704</span>     smartscreen.ex  <span class="number">0</span>xa50bb4d6a080  <span class="number">7</span>       -       <span class="number">1</span>       False</span><br><span class="line"><span class="number">7364</span>    <span class="number">4732</span>    cmd.exe         <span class="number">0</span>xa50bbd8a8080  <span class="number">1</span>       -       <span class="number">1</span>       False</span><br><span class="line"><span class="number">8916</span>    <span class="number">2136</span>    cmd.exe         <span class="number">0</span>xa50bb78d9080  <span class="number">0</span>       -       <span class="number">0</span>       False</span><br><span class="line"><span class="number">4768</span>    <span class="number">8916</span>    ipconfig.exe    <span class="number">0</span>xa50bba7bd080  <span class="number">0</span>       -       <span class="number">0</span>       False</span><br></pre></td></tr></table></figure>

<p>这里我们看到了实际的进程及其内存偏移量。为了节省空间，所以省略了一些列。下面列出了几个有趣的进程，包括我们在 <em>cmdline</em> 插件的输出中看到的 cmd 和 notepad 进程。</p>
<p>最好将进程看作一个层次结构，这样我们就可以知道是什么进程启动了其他进程。为此，我们将使用到 <em>pstree</em> 插件：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">PS&gt;vol <span class="operator">-f</span> WinDev2007Eval<span class="literal">-7d959ee5</span>.vmem windows.pstree</span><br><span class="line">Volatility <span class="number">3</span> Framework <span class="number">1.2</span>.<span class="number">0</span><span class="literal">-beta</span>.<span class="number">1</span></span><br><span class="line">Progress:   <span class="number">33.01</span>               Scanning primary2 <span class="keyword">using</span> PdbSignatureScanner</span><br><span class="line">PID     PPID    ImageFileName   Offset(V)    Threads Handles SessionId Wow64</span><br><span class="line"><span class="number">4</span>          <span class="number">0</span>      System          <span class="number">0</span>xa50bba7bd080  <span class="number">129</span>     N/A     False</span><br><span class="line">* <span class="number">556</span>    <span class="number">492</span>      services.exe    <span class="number">0</span>xa50bba7bd080    <span class="number">8</span>       <span class="number">0</span>       False</span><br><span class="line">** <span class="number">2176</span>  <span class="number">556</span>      wlms.exe        <span class="number">0</span>xa50bba7bd080    <span class="number">2</span>       <span class="number">0</span>       False</span><br><span class="line">** <span class="number">1796</span>  <span class="number">556</span>      svchost.exe     <span class="number">0</span>xa50bba7bd080   <span class="number">13</span>       <span class="number">0</span>       False</span><br><span class="line">** <span class="number">776</span>   <span class="number">556</span>      svchost.exe     <span class="number">0</span>xa50bba7bd080   <span class="number">15</span>       <span class="number">0</span>       False</span><br><span class="line">** <span class="number">8</span>     <span class="number">556</span>      svchost.exe     <span class="number">0</span>xa50bba7bd080   <span class="number">18</span>       <span class="number">0</span>       False</span><br><span class="line">*** <span class="number">4556</span>   <span class="number">8</span>      ctfmon.exe      <span class="number">0</span>xa50bba7bd080   <span class="number">10</span>       <span class="number">1</span>       False</span><br><span class="line">*** <span class="number">5388</span> <span class="number">704</span>      MicrosoftEdge.  <span class="number">0</span>xa50bba7bd080   <span class="number">35</span>       <span class="number">1</span>       False</span><br><span class="line">*** <span class="number">6448</span> <span class="number">704</span>      Calculator.exe  <span class="number">0</span>xa50bba7bd080   <span class="number">21</span>       <span class="number">1</span>       False</span><br><span class="line">*** <span class="number">3324</span> <span class="number">704</span>      smartscreen.ex  <span class="number">0</span>xa50bba7bd080    <span class="number">7</span>       <span class="number">1</span>       False</span><br><span class="line">** <span class="number">2136</span>  <span class="number">556</span>      vmtoolsd.exe    <span class="number">0</span>xa50bba7bd080   <span class="number">11</span>       <span class="number">0</span>       False</span><br><span class="line">*** <span class="number">8916</span> <span class="number">2136</span>     cmd.exe         <span class="number">0</span>xa50bba7bd080   <span class="number">0</span>        <span class="number">0</span>       False</span><br><span class="line">**** <span class="number">4768</span> <span class="number">8916</span>    ipconfig.exe    <span class="number">0</span>xa50bba7bd080   <span class="number">0</span>        <span class="number">0</span>       False</span><br><span class="line">* <span class="number">4704</span>           <span class="number">624</span>    userinit.exe      <span class="number">0</span>xa50bba7bd080  <span class="number">0</span>   <span class="number">1</span> False</span><br><span class="line">** <span class="number">4732</span>         <span class="number">4704</span>     explorer.exe     <span class="number">0</span>xa50bba7bd080  <span class="number">92</span>  <span class="number">1</span> False</span><br><span class="line">*** <span class="number">6432</span>        <span class="number">4732</span>     PowerToys.exe    <span class="number">0</span>xa50bba7bd080  <span class="number">14</span>  <span class="number">1</span> False</span><br><span class="line">**** <span class="number">5340</span>       <span class="number">6432</span>      Microsoft.Powe  <span class="number">0</span>xa50bba7bd080  <span class="number">15</span>  <span class="number">1</span> False</span><br><span class="line">*** <span class="number">7364</span>        <span class="number">4732</span>     cmd.exe          <span class="number">0</span>xa50bba7bd080  <span class="number">1</span>   - False</span><br><span class="line">**** <span class="number">2464</span>       <span class="number">7364</span>      conhost.exe     <span class="number">0</span>xa50bba7bd080  <span class="number">4</span>   <span class="number">1</span> False</span><br><span class="line">*** <span class="number">7092</span>        <span class="number">4732</span>     cmd.exe          <span class="number">0</span>xa50bba7bd080  <span class="number">1</span>   - False</span><br><span class="line">**** <span class="number">3312</span>       <span class="number">7092</span>      notepad.exe     <span class="number">0</span>xa50bba7bd080  <span class="number">3</span>   <span class="number">1</span> False</span><br><span class="line">**** <span class="number">7124</span>       <span class="number">7092</span>      nc64.exe        <span class="number">0</span>xa50bba7bd080  <span class="number">1</span>   <span class="number">1</span> False</span><br><span class="line">*** <span class="number">8564</span>        <span class="number">4732</span>     python<span class="literal">-3</span>.<span class="number">8.6</span><span class="literal">-a</span>   <span class="number">0</span>xa50bba7bd080  <span class="number">1</span>   <span class="number">1</span> True</span><br><span class="line">**** <span class="number">1036</span>       <span class="number">8564</span>      python<span class="literal">-3</span>.<span class="number">8.6</span><span class="literal">-a</span>  <span class="number">0</span>xa50bba7bd080  <span class="number">5</span>   <span class="number">1</span> True</span><br></pre></td></tr></table></figure>

<p>现在我们得到了一个更清晰的画面。每行中的星号表示进程的父子关系。例如， <em>userinit</em> 进程（PID 4704）生成了 <em>explorer.exe</em> 进程。同样， <em>explorer.exe</em> 进程（PID 4732）启动 <em>cmd.exe</em> 进程（PID 7092）。从这个进程中，用户启动了 <em>notepad.exe</em> 和另一个名为 <em>nc64.exe</em> 的进程。</p>
<p>现在让我们用 <em>hashdump</em> 插件检查密码：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">PS&gt; vol <span class="operator">-f</span> WinDev2007Eval<span class="literal">-7d959ee5</span>.vmem windows.hashdump</span><br><span class="line">Volatility <span class="number">3</span> Framework <span class="number">1.2</span>.<span class="number">0</span><span class="literal">-beta</span>.<span class="number">1</span></span><br><span class="line">Progress:   <span class="number">33.01</span>               Scanning primary2 <span class="keyword">using</span> PdbSignatureScanner</span><br><span class="line">User               rid     lmhash                            nthash</span><br><span class="line">Administrator      <span class="number">500</span>     aad3bXXXXXXaad3bXXXXXX fc6eb57eXXXXXXXXXXX657878</span><br><span class="line">Guest              <span class="number">501</span>     aad3bXXXXXXaad3bXXXXXX <span class="number">1</span>d6cfe0dXXXXXXXXXXXc089c0</span><br><span class="line">DefaultAccount     <span class="number">503</span>     aad3bXXXXXXaad3bXXXXXX <span class="number">1</span>d6cfe0dXXXXXXXXXXXc089c0</span><br><span class="line">WDAGUtilityAccount <span class="number">504</span>     aad3bXXXXXXaad3bXXXXXX ed66436aXXXXXXXXXXX1bb50f</span><br><span class="line">User              <span class="number">1001</span>     aad3bXXXXXXaad3bXXXXXX <span class="number">31</span>d6cfe0XXXXXXXXXXXc089c0</span><br><span class="line">tim               <span class="number">1002</span>     aad3bXXXXXXaad3bXXXXXX afc6eb57XXXXXXXXXXX657878</span><br><span class="line">admin             <span class="number">1003</span>     aad3bXXXXXXaad3bXXXXXX afc6eb57XXXXXXXXXXX657878</span><br></pre></td></tr></table></figure>

<p>输出显示帐户用户名及其密码的 LM 和 NT 散列。攻击者的一个共同目标是在入侵后恢复 Windows 机器上的密码哈希值。这些散列可以脱机破解以试图恢复目标的密码，也可以用于传递散列攻击以获得对其他网络资源的访问。无论目标用户是只在虚拟机上执行高风险操作的偏执用户，还是试图将其用户的某些活动包含到虚拟机的企业用户，查看系统上的虚拟机或快照都是在获得对主机硬件的访问权限后尝试恢复这些散列的最佳时机。</p>
<p>Volatility 使得这一复苏过程极为容易。</p>
<p>我们已经混淆了输出中的散列。您可以使用自己的输出作为散列破解工具的输入，以找到进入 VM 的方法。有几个在线哈希破解网站；或者，你可以在你的 kali 机上使用  John the Ripper 。</p>
<p>(笔者注： <strong>John the Ripper</strong> 是一个快速的密码破解工具，用于在已知密文的情况下尝试破解出明文，支持目前大多数的加密算法，如 DES、MD4、MD5 等。它支持多种不同类型的系统架构，包括 Unix、Linux、Windows、DOS 模式、 BeOS 和 OpenVMS ，主要目的是破解不够牢固的 Unix/Linux 系统密码。除了在各种 Unix 系统上最常见的几种密码哈希类型之外，它还支持 Windows LM 散列，以及社区增强版本中的许多其他哈希和密码。它是一款开源软件。Kali中自带John。)</p>
<h2 id="漏洞侦察"><a href="#漏洞侦察" class="headerlink" title="漏洞侦察"></a>漏洞侦察</h2><p>现在，让我们使用 Volatility 来发现目标 VM 是否存在可以利用的漏洞。 <em>malfind</em> 插件检查可能包含注入代码的进程内存范围。 <em>Potential</em> 是这里的关键词——插件正在寻找具有读、写和执行权限的内存区域。调查这些进程是值得的，因为它们可能帮助我们能够利用一些已经可用的恶意软件。或者，我们可以用自己的恶意软件覆盖这些区域。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">PS&gt;vol <span class="operator">-f</span> WinDev2007Eval<span class="literal">-7d959ee5</span>.vmem windows.malfind</span><br><span class="line">Volatility <span class="number">3</span> Framework <span class="number">1.2</span>.<span class="number">0</span><span class="literal">-beta</span>.<span class="number">1</span></span><br><span class="line">Progress:   <span class="number">33.01</span>               Scanning primary2 <span class="keyword">using</span> PdbSignatureScanner</span><br><span class="line">PID  <span class="keyword">Process</span>         Start VPN     <span class="keyword">End</span> VPN       Tag  Protection       CommitCharge</span><br><span class="line"><span class="number">1336</span> timeserv.exe    <span class="number">0</span>x660000      <span class="number">0</span>x660fff      VadS PAGE_EXECUTE_READWRITE  <span class="number">1</span></span><br><span class="line"><span class="number">2160</span> MsMpEng.exe     <span class="number">0</span>x16301690000 <span class="number">0</span>x1630179cfff VadS PAGE_EXECUTE_READWRITE  <span class="number">269</span></span><br><span class="line"><span class="number">2160</span> MsMpEng.exe     <span class="number">0</span>x16303090000 <span class="number">0</span>x1630318ffff VadS PAGE_EXECUTE_READWRITE  <span class="number">256</span></span><br><span class="line"><span class="number">2160</span> MsMpEng.exe     <span class="number">0</span>x16304a00000 <span class="number">0</span>x16304bfffff VadS PAGE_EXECUTE_READWRITE  <span class="number">512</span></span><br><span class="line"><span class="number">6484</span> FreeDesktopClo  <span class="number">0</span>x2320000     <span class="number">0</span>x2320fff     VadS PAGE_EXECUTE_READWRITE  <span class="number">1</span></span><br><span class="line"><span class="number">5340</span> Microsoft.Powe  <span class="number">0</span>x2c2502c0000 <span class="number">0</span>x2c2502cffff VadS PAGE_EXECUTE_READWRITE  <span class="number">15</span></span><br></pre></td></tr></table></figure>

<p>我们遇到了一些潜在的问题。 <em>timeserv.exe</em> 进程（PID 1336）是 <em>FreeDesktopClock</em> （PID 6484）免费软件的一部分。只要他们被安装到 <em>C:\Program Files</em> 目录下，这些不一定是问题。否则，该进程可能是伪装成时钟的恶意软件。</p>
<p>使用搜索引擎，你会发现进程 <em>MsMpEng.exe</em> (PID 2160)是一个防恶意软件服务。尽管这些进程包含可写和可执行的内存区域，但它们看起来并不危险。也许我们可以通过在这些内存区域中编写 shellcode 来使这些进程变得危险，所以值得注意它们。</p>
<p><em>netscan</em> 插件提供了快照时计算机拥有的所有网络连接的列表，如下所示。任何看起来可疑的东西我们都可以用来发动袭击。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">PS&gt;vol <span class="operator">-f</span> WinDev2007Eval<span class="literal">-7d959ee5</span>.vmem windows.netscan</span><br><span class="line">Volatility <span class="number">3</span> Framework <span class="number">1.2</span>.<span class="number">0</span><span class="literal">-beta</span>.<span class="number">1</span></span><br><span class="line">Progress:   <span class="number">33.01</span>               Scanning primary2 <span class="keyword">using</span> PdbSignatureScanner</span><br><span class="line">Offset         Proto LocalAddr  LocalPort ForeignAdd ForeignPort State     PID  Owner</span><br><span class="line"><span class="number">0</span>xa50bb7a13d90 TCPv4 <span class="number">0.0</span>.<span class="number">0.0</span>         <span class="number">4444</span> <span class="number">0.0</span>.<span class="number">0.0</span> <span class="number">0</span>            LISTENING   <span class="number">7124</span> nc64.exe [<span class="number">1</span>]</span><br><span class="line"><span class="number">0</span>xa50bb9f4c310 TCPv4 <span class="number">0.0</span>.<span class="number">0.0</span>         <span class="number">7680</span> <span class="number">0.0</span>.<span class="number">0.0</span> <span class="number">0</span>            LISTENING   <span class="number">1776</span> svchost.exe</span><br><span class="line"><span class="number">0</span>xa50bb9f615c0 TCPv4 <span class="number">0.0</span>.<span class="number">0.0</span>        <span class="number">49664</span> <span class="number">0.0</span>.<span class="number">0.0</span> <span class="number">0</span>            LISTENING   <span class="number">564</span>  lsass.exe</span><br><span class="line"><span class="number">0</span>xa50bb9f62190 TCPv4 <span class="number">0.0</span>.<span class="number">0.0</span>        <span class="number">49665</span> <span class="number">0.0</span>.<span class="number">0.0</span> <span class="number">0</span>            LISTENING   <span class="number">492</span>  wininit.exe</span><br><span class="line"><span class="number">0</span>xa50bbaa80b20 TCPv4 <span class="number">192.168</span>.<span class="number">28.128</span>  <span class="number">50948</span> <span class="number">23.40</span>.<span class="number">62.19</span>    <span class="number">80</span>    CLOSED [<span class="number">2</span>]</span><br><span class="line">w0xa50bbabd2010 TCPv4 <span class="number">192.168</span>.<span class="number">28.128</span> <span class="number">50954</span> <span class="number">23.193</span>.<span class="number">33.57</span>   <span class="number">443</span>   CLOSED</span><br><span class="line"><span class="number">0</span>xa50bbad8d010 TCPv4 <span class="number">192.168</span>.<span class="number">28.128</span>  <span class="number">50953</span> <span class="number">99.84</span>.<span class="number">222.93</span>   <span class="number">443</span>   CLOSED</span><br><span class="line"><span class="number">0</span>xa50bbaef3010 TCPv4 <span class="number">192.168</span>.<span class="number">28.128</span>  <span class="number">50959</span> <span class="number">23.193</span>.<span class="number">33.57</span>   <span class="number">443</span>   CLOSED</span><br><span class="line"><span class="number">0</span>xa50bbaff7010 TCPv4 <span class="number">192.168</span>.<span class="number">28.128</span>  <span class="number">50950</span> <span class="number">52.179</span>.<span class="number">224.121</span> <span class="number">443</span>   CLOSED</span><br><span class="line"><span class="number">0</span>xa50bbbd240a0 TCPv4 <span class="number">192.168</span>.<span class="number">28.128</span>    <span class="number">139</span>   <span class="number">0.0</span>.<span class="number">0.0</span> <span class="number">0</span>            LISTENING</span><br></pre></td></tr></table></figure>

<p>我们看到一些来自本地机器(192.168.28.128)的连接，显然到一些 web 服务器[2];这些连接现在已经关闭。更重要的是标记为 LISTENING 的连接。那些属于可识别的 Windows 进程( <em>svchost</em> , <em>lsass</em> ,  <em>wininit</em> )的进程可能没有问题，但 <em>nc64.exe</em> 进程是未知的[1]。它正在侦听端口4444，通过使用第2章中的 netcat 替代品来探测该端口对它进行更深入的研究也是很有价值的。</p>
<h2 id="volshell-接口"><a href="#volshell-接口" class="headerlink" title="volshell 接口"></a>volshell 接口</h2><p>（笔者注： volshell ，内存镜像中的shell ）</p>
<p>除了命令行界面，您还可以使用 volshell 命令在自定义 Python shell 中使用 Volatility 。这为您提供了 Volatility 的所有功能以及完整的 Python shell 。下面是一个在 Windows 映像上使用 volshell 利用 pslist 插件的例子:</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">PS&gt; volshell <span class="literal">-w</span> <span class="operator">-f</span> WinDev2007Eval<span class="literal">-7d959ee5</span>.vmem [<span class="number">1</span>]</span><br><span class="line">&gt;&gt;&gt; from volatility.plugins.windows import pslist [<span class="number">2</span>]</span><br><span class="line">&gt;&gt;&gt; dpo(pslist.PsList, primary=self.current_layer, nt_symbols=self.config[<span class="string">'nt_symbols'</span>]) [<span class="number">3</span>]</span><br><span class="line">PID     PPID    ImageFileName   Offset(V)   Threads Handles SessionId   Wow64</span><br><span class="line"><span class="number">4</span>       <span class="number">0</span>       System          <span class="number">0</span>xa50bb3e6d040  <span class="number">129</span>     -       N/A     False</span><br><span class="line"><span class="number">72</span>      <span class="number">4</span>       Registry        <span class="number">0</span>xa50bb3fbd080  <span class="number">4</span>       -       N/A     False</span><br><span class="line"><span class="number">6452</span>    <span class="number">4732</span>    OneDrive.exe    <span class="number">0</span>xa50bb4d62080  <span class="number">25</span>      -       <span class="number">1</span>       True</span><br><span class="line"><span class="number">6484</span>    <span class="number">4732</span>    FreeDesktopClo  <span class="number">0</span>xa50bbb847300  <span class="number">1</span>       -       <span class="number">1</span>       False</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>在这个简短的示例中，我们使用 -w 选项来告诉 Volatility 我们正在分析一个 Windows 图像，使用 -f 选项来指定图像本身[1]。一旦进入 volshell 接口，我们就可以像使用普通的 Python shell 一样使用它。也就是说，您可以像往常一样导入包或编写函数，但是现在您还在 shell 中嵌入了 Volatility 。我们导入 <em>pslist</em> 插件[2]并利用 <em>dpo</em> 函数显示插件[3]的输出。</p>
<p>你可以通过输入 <code>volshell --help</code> 找到更多关于使用 volshell 的信息。</p>
<h2 id="自定义-Volatility-插件"><a href="#自定义-Volatility-插件" class="headerlink" title="自定义 Volatility 插件"></a>自定义 Volatility 插件</h2><p>我们刚刚看到了如何使用 Volatility 插件来分析存在漏洞的 VM 快照，通过检查正在使用的命令和进程来分析用户，并转储密码散列。但是由于您可以编写自己的自定义插件，所以只有您的想象力才能限制您可以用 Volatility 做什么。如果您需要根据从标准插件找到的线索中获得额外的信息，那么您可以制作自己的插件。</p>
<p>只要您遵循 Volatility 团队的模式，就可以很容易地创建插件。您甚至可以让您的新插件调用其他插件，从而使您的工作更加容易。</p>
<p>让我们来看看一个典型插件的框架:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">imports . . .</span><br><span class="line">[<span class="number">1</span>] <span class="class"><span class="keyword">class</span> <span class="title">CmdLine</span><span class="params">(interfaces.plugin.PluginInterface)</span>:</span></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    [<span class="number">2</span>] <span class="function"><span class="keyword">def</span> <span class="title">get_requirements</span><span class="params">(cls)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    [<span class="number">3</span>] <span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    [<span class="number">4</span>] <span class="function"><span class="keyword">def</span> <span class="title">generator</span><span class="params">(self, procs)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>

<p>这里的主要步骤是创建从 <em>PluginInterface</em> [1]继承的新类，定义插件的需求[2]，定义 <em>run</em> 类函数[3]，以及定义 <em>generator</em> 类函数[4]。 <em>generator</em> 类函数是可选的，但是将它与 <em>run</em> 类函数分离是您将在许多插件中看到的有用模式。通过分离它并将其作为 Python 生成器使用，您可以获得更快的结果，并使代码更容易理解。</p>
<p>让我们遵循这个通用模式来创建一个自定义插件，该插件将检查不受 <em>address space layout randomization</em> (ASLR，地址空间布局随机化)保护的进程。 ASLR 混合了脆弱进程的地址空间，这影响了堆、栈和其他操作系统分配的虚拟内存位置。这意味着攻击者无法确定在攻击时受害进程的地址空间是如何布置的。 Windows Vista 是第一个支持 ASLR 的 Windows 版本。在 Windows XP 等较旧的内存镜像中，默认情况下不会启用 ASLR 保护。现在，在最新的电脑 (Windows 10) 中，几乎所有的进程都受到了保护。</p>
<p>ASLR 并不意味着攻击者就一定失败了，但它使工作变得更加复杂。作为侦察进程的第一步，我们将创建一个插件来检查流程是否受到 ASLR 的保护。</p>
<p>让我们开始吧。创建一个名为 <em>plugins</em> 的目录。在该目录下，创建一个名为 <em>windows</em> 目录，以存放用于 Windows 机器的自定义插件。如果您创建插件以 Mac 或 Linux 机器为目标，请分别创建一个名为 <em>mac</em> 或 <em>linux</em> 的目录。</p>
<p>现在，在 <em>plugins/windows</em> 目录下，让我们编写我们的 ASLR 检查插件， <em>aslrcheck.py</em> :</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Search all processes and check for ASLR protection</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> Callable, List</span><br><span class="line"><span class="keyword">from</span> volatility.framework <span class="keyword">import</span> constants, exceptions, interfaces, renderers</span><br><span class="line"><span class="keyword">from</span> volatility.framework.configuration <span class="keyword">import</span> requirements</span><br><span class="line"><span class="keyword">from</span> volatility.framework.renderers <span class="keyword">import</span> format_hints</span><br><span class="line"><span class="keyword">from</span> volatility.framework.symbols <span class="keyword">import</span> intermed</span><br><span class="line"><span class="keyword">from</span> volatility.framework.symbols.windows <span class="keyword">import</span> extensions</span><br><span class="line"><span class="keyword">from</span> volatility.plugins.windows <span class="keyword">import</span> pslist</span><br><span class="line"><span class="keyword">import</span> io</span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> pefile</span><br><span class="line">vollog = logging.getLogger(__name__)</span><br><span class="line">IMAGE_DLL_CHARACTERISTICS_DYNAMIC_BASE = <span class="number">0x0040</span></span><br><span class="line">IMAGE_FILE_RELOCS_STRIPPED = <span class="number">0x0001</span></span><br></pre></td></tr></table></figure>

<p>我们首先处理所需的导入，再加上用于分析 Portable Executable file (PE，可移植可执行文件)的 <em>pefile</em> 库。现在让我们编写一个辅助函数来进行分析:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">1</span>] <span class="function"><span class="keyword">def</span> <span class="title">check_aslr</span><span class="params">(pe)</span>:</span></span><br><span class="line">    pe.parse_data_directories([</span><br><span class="line">        pefile.DIRECTORY_ENTRY[<span class="string">'IMAGE_DIRECTORY_ENTRY_LOAD_CONFIG'</span>]</span><br><span class="line">    ])</span><br><span class="line">    dynamic = <span class="literal">False</span></span><br><span class="line">    stripped = <span class="literal">False</span></span><br><span class="line">[<span class="number">2</span>] <span class="keyword">if</span> (pe.OPTIONAL_HEADER.DllCharacteristics &amp;</span><br><span class="line">        IMAGE_DLL_CHARACTERISTICS_DYNAMIC_BASE):</span><br><span class="line">        dynamic = <span class="literal">True</span></span><br><span class="line">[<span class="number">3</span>] <span class="keyword">if</span> pe.FILE_HEADER.Characteristics &amp; IMAGE_FILE_RELOCS_STRIPPED:</span><br><span class="line">        stripped = <span class="literal">True</span></span><br><span class="line">[<span class="number">4</span>] <span class="keyword">if</span> <span class="keyword">not</span> dynamic <span class="keyword">or</span> (dynamic <span class="keyword">and</span> stripped):</span><br><span class="line">        aslr = <span class="literal">False</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        aslr = <span class="literal">True</span></span><br><span class="line">    <span class="keyword">return</span> aslr</span><br></pre></td></tr></table></figure>

<p>我们将一个 PE 文件对象传递给 <em>check_aslr</em> 函数[1]，解析它，然后检查它是否已经用 DYNAMIC 基础设置编译[2]，以及是否存在文件重定位数据段[3]。如果它不是动态的，或者可能编译为动态的但没有重定位数据段，那么 PE 文件也就不受 ASLR 保护[4]。</p>
<p><em>check_aslr</em> 辅助函数已经准备好了，让我们创建我们的 <em>AslrCheck</em> 类:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">1</span>] <span class="class"><span class="keyword">class</span> <span class="title">AslrCheck</span><span class="params">(interfaces.plugins.PluginInterface)</span>:</span></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_requirements</span><span class="params">(cls)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> [</span><br><span class="line">        [<span class="number">2</span>] requirements.TranslationLayerRequirement(</span><br><span class="line">                name=<span class="string">'primary'</span>, description=<span class="string">'Memory layer for the kernel'</span>,</span><br><span class="line">                architectures=[<span class="string">"Intel32"</span>, <span class="string">"Intel64"</span>]),</span><br><span class="line">            [<span class="number">3</span>] requirements.SymbolTableRequirement(</span><br><span class="line">                name=<span class="string">"nt_symbols"</span>, description=<span class="string">"Windows kernel symbols"</span>),</span><br><span class="line">        [<span class="number">4</span>] requirements.PluginRequirement(</span><br><span class="line">                name=<span class="string">'pslist'</span>, plugin=pslist.PsList, version=(<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>)),</span><br><span class="line">        [<span class="number">5</span>] requirements.ListRequirement(name = <span class="string">'pid'</span>,</span><br><span class="line">             element_type = int,</span><br><span class="line">             description = <span class="string">"Process ID to include (all others are excluded)"</span>,</span><br><span class="line">             optional = <span class="literal">True</span>),</span><br><span class="line">            ]</span><br></pre></td></tr></table></figure>

<p>创建插件的第一步是从 <em>PluginInterface</em> 对象继承[1]。接下来，定义需求。通过查看其他插件，您可以很好地了解自己需要什么。每个插件都需要内存层，我们首先定义这个需求[2]。除了内存层，我们还需要符号表[3]。您会发现几乎所有插件都会使用这两个需求。</p>
<p>为了从内存中获取所有进程并从进程中重新创建PE文件[4]，我们还需要 <em>pslist</em> 插件。然后，我们将从每个进程传递重新创建的 PE 文件，并检查它是否有 ASLR 保护。</p>
<p>我们可能想要检查给定进程 ID 的单个进程，因此我们创建另一个可选设置，允许我们传入一个进程 ID 列表，以限制只检查那些进程[5]。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">create_pid_filter</span><span class="params">(cls, pid_list: List[int] = None)</span> -&gt; Callable[[interfaces.objects.ObjectInterface], bool]:</span></span><br><span class="line">        filter_func = <span class="keyword">lambda</span> _: <span class="literal">False</span></span><br><span class="line">        pid_list = pid_list <span class="keyword">or</span> []</span><br><span class="line">        filter_list = [x <span class="keyword">for</span> x <span class="keyword">in</span> pid_list <span class="keyword">if</span> x <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>]</span><br><span class="line">        <span class="keyword">if</span> filter_list:</span><br><span class="line">            filter_func = <span class="keyword">lambda</span> x: x.UniqueProcessId <span class="keyword">not</span> <span class="keyword">in</span> filter_list</span><br><span class="line">        <span class="keyword">return</span> filter_func</span><br></pre></td></tr></table></figure>

<p>为了处理可选的进程 ID ，我们使用一个类函数创建一个过滤函数，该函数为列表中的每个进程 ID 返回 False ;也就是说，我们询问过滤函数的问题是是否过滤掉一个进程，所以只有 PID 不在列表中时才返回 True :</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_generator</span><span class="params">(self, procs)</span>:</span></span><br><span class="line">        pe_table_name = intermed.IntermediateSymbolTable.create( [<span class="number">1</span>]</span><br><span class="line">            self.context,</span><br><span class="line">            self.config_path,</span><br><span class="line">            <span class="string">"windows"</span>,</span><br><span class="line">            <span class="string">"pe"</span>,</span><br><span class="line">            class_types=extensions.pe.class_types)</span><br><span class="line">        procnames = list()</span><br><span class="line">        <span class="keyword">for</span> proc <span class="keyword">in</span> procs:</span><br><span class="line">            procname = proc.ImageFileName.cast(<span class="string">"string"</span>,</span><br><span class="line">                max_length=proc.ImageFileName.vol.count, errors=<span class="string">'replace'</span>)</span><br><span class="line">            <span class="keyword">if</span> procname <span class="keyword">in</span> procnames:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            procnames.append(procname)</span><br><span class="line">            proc_id = <span class="string">"Unknown"</span></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                proc_id = proc.UniqueProcessId</span><br><span class="line">                proc_layer_name = proc.add_process_layer()</span><br><span class="line">            <span class="keyword">except</span> exceptions.InvalidAddressException <span class="keyword">as</span> e:</span><br><span class="line">                vollog.error(<span class="string">f"Process <span class="subst">&#123;proc_id&#125;</span>: invalid address <span class="subst">&#123;e&#125;</span> in layer <span class="subst">&#123;e.layer_name&#125;</span>"</span>)</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">           peb = self.context.object( [<span class="number">2</span>]</span><br><span class="line">                    self.config[<span class="string">'nt_symbols'</span>] + constants.BANG + <span class="string">"_PEB"</span>,</span><br><span class="line">                    layer_name = proc_layer_name,</span><br><span class="line">                    offset = proc.Peb)</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                dos_header = self.context.object(</span><br><span class="line">                        pe_table_name + constants.BANG + <span class="string">"_IMAGE_DOS_HEADER"</span>,</span><br><span class="line">                        offset=peb.ImageBaseAddress,</span><br><span class="line">                        layer_name=proc_layer_name)</span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            pe_data = io.BytesIO()</span><br><span class="line">            <span class="keyword">for</span> offset, data <span class="keyword">in</span> dos_header.reconstruct():</span><br><span class="line">                pe_data.seek(offset)</span><br><span class="line">                pe_data.write(data)</span><br><span class="line">            pe_data_raw = pe_data.getvalue() [<span class="number">3</span>]</span><br><span class="line">            pe_data.close()</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                pe = pefile.PE(data=pe_data_raw) [<span class="number">4</span>]</span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            aslr = check_aslr(pe) [<span class="number">5</span>]</span><br><span class="line">            <span class="keyword">yield</span> (<span class="number">0</span>, (proc_id, [<span class="number">6</span>]</span><br><span class="line">                        procname,</span><br><span class="line">                        format_hints.Hex(pe.OPTIONAL_HEADER.ImageBase),</span><br><span class="line">                        aslr,</span><br><span class="line">                        ))</span><br></pre></td></tr></table></figure>

<p>我们创建了一个名为 <em>pe_table_name</em> [1]的特殊数据结构，用于循环内存中的每个进程。然后我们得到与每个进程相关联的Process Environment Block (PEB，进程环境块)内存区域，并将其放入对象中[2]。 PEB 是当前进程的数据结构，它包含了关于进程的大量信息。我们向该区域写入一个类文件对象 (pe_data) [3]，使用 <em>pefile</em> 库创建一个 PE 对象[4]，并将其传递给 <em>check_aslr</em> 辅助函数[5]。最后，我们生成包含进程 ID 、进程名、进程内存地址的信息元组，以及来自 ASLR 保护检查[6]的 Boolean (布尔值)结果。</p>
<p>现在我们创建 <em>run</em> 类函数，它不需要任何参数，因为所有的设置都被填充到 config 对象中:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(self)</span>:</span></span><br><span class="line"> <span class="number">1</span> procs = pslist.PsList.list_processes(self.context,</span><br><span class="line">                                         self.config[<span class="string">"primary"</span>],</span><br><span class="line">                                         self.config[<span class="string">"nt_symbols"</span>],</span><br><span class="line">                                         filter_func =</span><br><span class="line">            self.create_pid_filter(self.config.get(<span class="string">'pid'</span>, <span class="literal">None</span>)))</span><br><span class="line"> <span class="number">2</span> <span class="keyword">return</span> renderers.TreeGrid([</span><br><span class="line">        (<span class="string">"PID"</span>, int),</span><br><span class="line">        (<span class="string">"Filename"</span>, str),</span><br><span class="line">        (<span class="string">"Base"</span>, format_hints.Hex),</span><br><span class="line">        (<span class="string">"ASLR"</span>, bool)],</span><br><span class="line">        self._generator(procs))</span><br></pre></td></tr></table></figure>

<p>我们使用 <em>pslist</em> 插件获取进程列表[1]，并使用 TreeGrid 渲染器从生成器返回数据[2]。许多插件都使用 TreeGrid 渲染器。它确保我们为每个分析的进程得到一行结果。</p>
<p>(笔者注： TreeGrid 是一种 DHTML 控件，其完全使用 JavaScript 语言编写，用以在HTML页面上展示具有层次结构的数据项 ，其核心技术为多叉树。)</p>
<h3 id="Kicking-the-Tires"><a href="#Kicking-the-Tires" class="headerlink" title="Kicking the Tires"></a>Kicking the Tires</h3><p>让我们看一看在 Volatility 网站上提供的其中一个有效映像: Malware - Cridex 。对于您的自定义插件，提供 -p 选项与您的 <em>plugins</em> 文件夹路径:</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">PS&gt;vol <span class="literal">-p</span> .\plugins\windows <span class="operator">-f</span> cridex.vmem aslrcheck.AslrCheck</span><br><span class="line">Volatility <span class="number">3</span> Framework <span class="number">1.2</span>.<span class="number">0</span><span class="literal">-beta</span>.<span class="number">1</span></span><br><span class="line">Progress:    <span class="number">0.00</span>               Scanning primary2 <span class="keyword">using</span> PdbSignatureScanner</span><br><span class="line">PID     Filename        Base    ASLR</span><br><span class="line"><span class="number">368</span>     smss.exe        <span class="number">0</span>x48580000      False</span><br><span class="line"><span class="number">584</span>     csrss.exe       <span class="number">0</span>x4a680000      False</span><br><span class="line"><span class="number">608</span>     winlogon.exe    <span class="number">0</span>x1000000       False</span><br><span class="line"><span class="number">652</span>     services.exe    <span class="number">0</span>x1000000       False</span><br><span class="line"><span class="number">664</span>     lsass.exe       <span class="number">0</span>x1000000       False</span><br><span class="line"><span class="number">824</span>     svchost.exe     <span class="number">0</span>x1000000       False</span><br><span class="line"><span class="number">1484</span>    explorer.exe    <span class="number">0</span>x1000000       False</span><br><span class="line"><span class="number">1512</span>    spoolsv.exe     <span class="number">0</span>x1000000       False</span><br><span class="line"><span class="number">1640</span>    reader_sl.exe   <span class="number">0</span>x400000        False</span><br><span class="line"><span class="number">788</span>     alg.exe         <span class="number">0</span>x1000000       False</span><br><span class="line"><span class="number">1136</span>    wuauclt.exe     <span class="number">0</span>x400000        False</span><br></pre></td></tr></table></figure>

<p>如您所见，这是一台 Windows XP 机器，在任何进程上都没有 ASLR 保护。</p>
<p>下面是纯净的全新的 Windows 10 机器的结果:</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">PS&gt;vol <span class="literal">-p</span> .\plugins\windows <span class="operator">-f</span> WinDev2007Eval<span class="literal">-Snapshot4</span>.vmem aslrcheck.AslrCheck</span><br><span class="line">Volatility <span class="number">3</span> Framework <span class="number">1.2</span>.<span class="number">0</span><span class="literal">-beta</span>.<span class="number">1</span></span><br><span class="line">Progress:   <span class="number">33.01</span>               Scanning primary2 <span class="keyword">using</span> PdbSignatureScanner</span><br><span class="line">PID     Filename        Base    ASLR</span><br><span class="line"><span class="number">316</span>     smss.exe        <span class="number">0</span>x7ff668020000  True</span><br><span class="line"><span class="number">428</span>     csrss.exe       <span class="number">0</span>x7ff796c00000  True</span><br><span class="line"><span class="number">500</span>     wininit.exe     <span class="number">0</span>x7ff7d9bc0000  True</span><br><span class="line"><span class="number">568</span>     winlogon.exe    <span class="number">0</span>x7ff6d7e50000  True</span><br><span class="line"><span class="number">592</span>     services.exe    <span class="number">0</span>x7ff76d450000  True</span><br><span class="line"><span class="number">600</span>     lsass.exe       <span class="number">0</span>x7ff6f8320000  True</span><br><span class="line"><span class="number">696</span>     fontdrvhost.ex  <span class="number">0</span>x7ff65ce30000  True</span><br><span class="line"><span class="number">728</span>     svchost.exe     <span class="number">0</span>x7ff78eed0000  True</span><br><span class="line">Volatility was unable to read a requested page:</span><br><span class="line">Page error <span class="number">0</span>x7ff65f4d0000 <span class="keyword">in</span> layer primary2_Process928 (Page Fault at entry <span class="number">0</span>xd40c9d88c8a00400 </span><br><span class="line"><span class="keyword">in</span> page entry)</span><br><span class="line"></span><br><span class="line"> * Memory smear during acquisition (<span class="keyword">try</span> re<span class="literal">-acquiring</span> <span class="keyword">if</span> possible)</span><br><span class="line"> * An intentionally invalid page lookup (operating system protection)</span><br><span class="line"> * A bug <span class="keyword">in</span> the plugin/volatility (re<span class="literal">-run</span> with <span class="literal">-vvv</span> and file a bug)</span><br><span class="line"></span><br><span class="line">No further results will be produced</span><br></pre></td></tr></table></figure>

<p>这里没什么可看的。每个列出的进程都受到 ASLR 的保护。然而，我们也看到了 <em>memory smear</em> ，内存污染。当拍摄内存映像时，内存存储的内容发生变化时，就会发生 <em>memory smear</em> 。这会导致内存表描述与内存本身不匹配;或者，虚拟内存指针可能引用无效数据。黑客攻击就会困难。正如错误描述所说，您可以尝试重新获取映像(寻找或创建一个新的快照)。</p>
<p>（笔者注：  <em>memory smear</em> ，在内存采集过程中，运行中系统对数据的修改。）</p>
<p>让我们检查 PassMark Windows 10 样本内存映像:</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">PS&gt;vol <span class="literal">-p</span> .\plugins\windows <span class="operator">-f</span> WinDump.mem aslrcheck.AslrCheck</span><br><span class="line">Volatility <span class="number">3</span> Framework <span class="number">1.2</span>.<span class="number">0</span><span class="literal">-beta</span>.<span class="number">1</span></span><br><span class="line">Progress:    <span class="number">0.00</span>               Scanning primary2 <span class="keyword">using</span> PdbSignatureScanner</span><br><span class="line">PID     Filename        Base    ASLR</span><br><span class="line"><span class="number">356</span>     smss.exe        <span class="number">0</span>x7ff6abfc0000  True</span><br><span class="line"><span class="number">2688</span>    MsMpEng.exe     <span class="number">0</span>x7ff799490000  True</span><br><span class="line"><span class="number">2800</span>    SecurityHealth  <span class="number">0</span>x7ff6ef1e0000  True</span><br><span class="line"><span class="number">5932</span>    GoogleCrashHan  <span class="number">0</span>xed0000        True</span><br><span class="line"><span class="number">5380</span>    SearchIndexer.  <span class="number">0</span>x7ff6756e0000  True</span><br><span class="line"><span class="number">3376</span>    winlogon.exe    <span class="number">0</span>x7ff65ec50000  True</span><br><span class="line"><span class="number">6976</span>    dwm.exe         <span class="number">0</span>x7ff6ddc80000  True</span><br><span class="line"><span class="number">9336</span>    atieclxx.exe    <span class="number">0</span>x7ff7bbc30000  True</span><br><span class="line"><span class="number">9932</span>    remsh.exe       <span class="number">0</span>x7ff736d40000  True</span><br><span class="line"><span class="number">2192</span>    SynTPEnh.exe    <span class="number">0</span>x140000000     False</span><br><span class="line"><span class="number">7688</span>    explorer.exe    <span class="number">0</span>x7ff7e7050000  True</span><br><span class="line"><span class="number">7736</span>    SynTPHelper.ex  <span class="number">0</span>x7ff7782e0000  True</span><br></pre></td></tr></table></figure>

<p>几乎所有进程都受到保护。只有一个进程 <em>SynTPEnh.exe</em> 不受 ASLR 保护。在线搜索显示，这是 Synaptics Pointing Device 的一个软件组件，可能用于触摸屏。只要这个进程被安装在 <em>c:\Program Files</em> 中，就没有问题的，但它可能值得以后去弄清楚。</p>
<p>在本章中，您看到了您可以利用 Volatility 框架的强大功能来查找关于用户行为和连接的更多信息，以及分析任何进程运行内存中的数据。您可以使用这些信息来更好地理解目标用户和机器，以及理解防御者的心态。</p>
<h2 id="Onward-前进吧"><a href="#Onward-前进吧" class="headerlink" title="Onward! (前进吧)"></a>Onward! (前进吧)</h2><p>现在您应该已经注意到， Python 是一种非常适合黑客编程的语言，特别是当您考虑到许多可用的库和基于 Python 的框架时。虽然黑客拥有大量的工具，但没有什么能替代编写自己的工具，因为这能让你更深入地了解其他工具在做什么。</p>
<p>继续前进，为您的特殊需求编写一个自定义工具。无论它是 Windows 的 SSH 客户端， web scraper （笔者注：  Web Scraper ，一个插件，轻量数据爬取利器），还是命令和控制系统， Python 都帮你搞定了。</p>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Ma9icCR</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://ma9iccr.github.io/2021-07/Black-Hat-Python-2nd-11/">https://ma9iccr.github.io/2021-07/Black-Hat-Python-2nd-11/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://ma9iccr.github.io" target="_blank">Ma9icCR</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Black-Hat-Python-2nd/">Black_Hat_Python_2nd</a></div><div class="post_share"><div class="social-share" data-image="https://ma9ic-image.obs.cn-north-4.myhuaweicloud.com/images/read.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"/><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2022-03/PWN%E5%85%A5%E9%97%A8%E5%88%B0%E5%85%A5%E7%8B%B1/"><img class="prev-cover" data-src="https://ma9ic-image.obs.cn-north-4.myhuaweicloud.com/images/pwn.png" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">PWN入门到入狱</div></div></a></div><div class="next-post pull-right"><a href="/2021-07/Black-Hat-Python-2nd-10/"><img class="next-cover" data-src="https://ma9ic-image.obs.cn-north-4.myhuaweicloud.com/images/BHP2nd.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Black Hat Python 2nd 10</div></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相关推荐</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/2021-07/Black-Hat-Python-2nd-10/" title="Black Hat Python 2nd 10"><img class="relatedPosts_cover" data-src="https://ma9ic-image.obs.cn-north-4.myhuaweicloud.com/images/BHP2nd.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="far fa-calendar-alt fa-fw"></i> 2021-07-20</div><div class="relatedPosts_title">Black Hat Python 2nd 10</div></div></a></div><div class="relatedPosts_item"><a href="/2021-07/Black-Hat-Python-2nd-9/" title="Black Hat Python 2nd 9"><img class="relatedPosts_cover" data-src="https://ma9ic-image.obs.cn-north-4.myhuaweicloud.com/images/BHP2nd.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="far fa-calendar-alt fa-fw"></i> 2021-07-18</div><div class="relatedPosts_title">Black Hat Python 2nd 9</div></div></a></div><div class="relatedPosts_item"><a href="/2021-07/Black-Hat-Python-2nd-8/" title="Black Hat Python 2nd 8"><img class="relatedPosts_cover" data-src="https://ma9ic-image.obs.cn-north-4.myhuaweicloud.com/images/BHP2nd.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="far fa-calendar-alt fa-fw"></i> 2021-07-13</div><div class="relatedPosts_title">Black Hat Python 2nd 8</div></div></a></div><div class="relatedPosts_item"><a href="/2021-07/Black-Hat-Python-2nd-7/" title="Black Hat Python 2nd 7"><img class="relatedPosts_cover" data-src="https://ma9ic-image.obs.cn-north-4.myhuaweicloud.com/images/BHP2nd.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="far fa-calendar-alt fa-fw"></i> 2021-07-08</div><div class="relatedPosts_title">Black Hat Python 2nd 7</div></div></a></div><div class="relatedPosts_item"><a href="/2021-07/Black-Hat-Python-2nd-6/" title="Black Hat Python 2nd 6"><img class="relatedPosts_cover" data-src="https://ma9ic-image.obs.cn-north-4.myhuaweicloud.com/images/BHP2nd.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="far fa-calendar-alt fa-fw"></i> 2021-07-03</div><div class="relatedPosts_title">Black Hat Python 2nd 6</div></div></a></div><div class="relatedPosts_item"><a href="/2021-06/Black-Hat-Python-2nd-5/" title="Black Hat Python 2nd 5"><img class="relatedPosts_cover" data-src="https://ma9ic-image.obs.cn-north-4.myhuaweicloud.com/images/BHP2nd.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="far fa-calendar-alt fa-fw"></i> 2021-06-28</div><div class="relatedPosts_title">Black Hat Python 2nd 5</div></div></a></div></div></div></article></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By Ma9icCR</div><div class="framework-info"><span>驱动 </span><a href="https://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div></div></footer></div><section id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="font_plus" type="button" title="放大字体"><i class="fas fa-plus"></i></button><button id="font_minus" type="button" title="缩小字体"><i class="fas fa-minus"></i></button><button id="translateLink" type="button" title="简繁转换">简</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script id="ribbon_piao" mobile="false" src="/js/third-party/piao.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module" defer></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js" async></script></body></html>